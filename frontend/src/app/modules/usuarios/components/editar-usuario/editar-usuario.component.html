<!-- Editar Usuario - Estilo Minimalista AgriCol -->
<div class="editar-container">

  <!-- Header -->
  <div class="page-header">
    <button class="btn-back" routerLink="/usuarios">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
      </svg>
      <span>Volver</span>
    </button>
    <div class="header-content">
      <div class="header-icon-wrapper">
        <svg class="header-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
        </svg>
      </div>
      <div class="header-text">
        <h1 class="page-title">Editar Usuario</h1>
        <p class="page-subtitle">Actualiza la información del usuario</p>
      </div>
    </div>
  </div>

  <!-- Loading -->
  @if (loading) {
    <div class="loading-container">
      <svg class="loading-spinner" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
      </svg>
      <p class="loading-text">Cargando usuario...</p>
    </div>
  }

  <!-- Error Alert -->
  @if (errorMessage && !loading) {
    <div class="alert-error">
      <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <span>{{ errorMessage }}</span>
    </div>
  }

  <!-- Success Alert -->
  @if (successMessage && !loading) {
    <div class="alert-success">
      <svg class="alert-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M5 13l4 4L19 7"/>
      </svg>
      <span>{{ successMessage }}</span>
    </div>
  }

  <!-- FORM -->
  @if (!loading) {
    <form class="form-card" (ngSubmit)="guardar()" #formUsuario="ngForm">

      <!-- ========== SECCIÓN 1 ========== -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-badge">1</div>
          <h2 class="section-title">Información Personal</h2>
        </div>

        <div class="form-grid">

          <!-- Nombre -->
          <div class="form-group">
            <label class="form-label">
              <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
              </svg>
              Nombre Completo
            </label>

            <input
              type="text"
              class="form-input"
              name="nombre"
              [(ngModel)]="formData.name"
              required
              minlength="3"
              placeholder="Ej: Juan Pérez"
              [class.input-error]="formUsuario.submitted && !formData.name">
            
            @if (formUsuario.submitted && !formData.name) {
              <p class="input-error-text">El nombre es obligatorio.</p>
            }
          </div>

          <!-- Email -->
          <div class="form-group">
            <label class="form-label">
              <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              Correo Electrónico
            </label>

            <input
              type="email"
              class="form-input"
              name="email"
              [(ngModel)]="formData.email"
              required
              placeholder="usuario@ejemplo.com"
              [class.input-error]="formUsuario.submitted && !validateEmail(formData.email)">
            
            @if (formUsuario.submitted && !validateEmail(formData.email)) {
              <p class="input-error-text">Ingresa un correo válido.</p>
            }
          </div>

        </div>
      </div>

      <!-- ========== SECCIÓN 2 ========== -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-badge">2</div>
          <h2 class="section-title">Seguridad</h2>
        </div>

        <div class="form-grid">

          <!-- Password -->
          <div class="form-group">
            <label class="form-label">
              <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
              </svg>
              Nueva Contraseña (opcional)
            </label>

            <input
              type="password"
              class="form-input"
              [(ngModel)]="formData.password"
              name="password"
              minlength="6"
              placeholder="Dejar vacío para no cambiar">

            @if (formData.password && formData.password.length < 6) {
              <p class="input-error-text">La contraseña debe tener mínimo 6 caracteres.</p>
            }
          </div>

          <!-- Rol -->
          <div class="form-group">
            <label class="form-label">Rol del Usuario</label>

            <div class="select-wrapper">
              <select class="form-select" [(ngModel)]="formData.role" name="role">
                <option value="admin">Administrador</option>
                <option value="user">Operador</option>
              </select>

              <svg class="select-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M19 9l-7 7-7-7"/>
              </svg>
            </div>
          </div>

        </div>
      </div>

      <!-- ========== SECCIÓN 3 Estado ========== -->
      <div class="form-section">
        <div class="section-header">
          <div class="section-badge">3</div>
          <h2 class="section-title">Estado del Usuario</h2>
        </div>

        <div class="radio-group">
          <label class="radio-option" [class.radio-selected]="formData.activo === true">
            <input type="radio" name="estado" [value]="true" [(ngModel)]="formData.activo">
            <span>Activo</span>
          </label>

          <label class="radio-option" [class.radio-selected]="formData.activo === false">
            <input type="radio" name="estado" [value]="false" [(ngModel)]="formData.activo">
            <span>Inactivo</span>
          </label>
        </div>
      </div>

      <!-- ========== BOTONES ========== -->
      <div class="form-actions">
        <button class="btn-cancel" type="button" (click)="cancelar()">
          Cancelar
        </button>

        <button class="btn-save" type="submit" [disabled]="saving || formUsuario.invalid">
          @if (!saving) {
            <span>Guardar Cambios</span>
          }
          @if (saving) {
            <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10"
                      stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 
                       5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 
                       5.824 3 7.938l3-2.647z"/>
            </svg>
          }
        </button>
      </div>

    </form>
  }

</div>
