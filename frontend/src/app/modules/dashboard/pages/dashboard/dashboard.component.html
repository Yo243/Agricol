<div class="dashboard-container">
  <!-- Header -->
  <header class="dashboard-header">
    <div>
      <h1 class="dashboard-title">AgriCol Dashboard</h1>
      <p class="dashboard-subtitle">
        Resumen general de tus operaciones agr√≠colas
      </p>
    </div>
    <button class="refresh-btn" (click)="loadDashboardData()" [disabled]="loading">
      <span class="refresh-icon">üîÑ</span>
      <span>Actualizar</span>
    </button>
  </header>

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando datos...</p>
    </div>
  }

  <!-- Error State -->
  @if (error && !loading) {
    <div class="error-state">
      <span class="error-icon">‚ö†Ô∏è</span>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadDashboardData()">Reintentar</button>
    </div>
  }

  <!-- Dashboard Content -->
  @if (!loading && !error) {
    <!-- M√©tricas principales -->
    <section class="metrics-grid">
      <!-- Parcelas -->
      <article class="metric-card metric-primary">
        <div class="metric-header">
          <h2 class="metric-title">Parcelas</h2>
        </div>
        <div class="metric-body">
          <div class="metric-value">{{ dashboardData.totalParcelas }}</div>
          <div class="metric-subtitle">
            {{ dashboardData.parcelasActivas }} activas ‚Ä¢ {{ dashboardData.totalHectareas | number:'1.1-1' }} ha
          </div>
        </div>
      </article>

      <!-- Inventario -->
      <article class="metric-card metric-info">
        <div class="metric-header">
          <h2 class="metric-title">Inventario</h2>
        </div>
        <div class="metric-body">
          <div class="metric-value">{{ dashboardData.totalProductos }}</div>
          <div class="metric-subtitle">
            Productos en stock ‚Ä¢ ${{ dashboardData.valorInventario | number:'1.0-0' }}
          </div>
        </div>
      </article>

      <!-- √ìrdenes -->
      <article class="metric-card metric-warning">
        <div class="metric-header">
          <h2 class="metric-title">√ìrdenes</h2>
        </div>
        <div class="metric-body">
          <div class="metric-value">{{ dashboardData.ordenesPendientes }}</div>
          <div class="metric-subtitle">
            Pendientes ‚Ä¢ {{ dashboardData.totalOrdenes }} total
          </div>
        </div>
      </article>

      <!-- Per√≠odos Activos -->
      <article class="metric-card metric-success">
        <div class="metric-header">
          <h2 class="metric-title">Per√≠odos Activos</h2>
        </div>
        <div class="metric-body">
          <div class="metric-value">{{ dashboardData.periodosActivos }}</div>
          <div class="metric-subtitle">
            Ciclos en curso ‚Ä¢ {{ dashboardData.hectareasSembradas | number:'1.1-1' }} ha sembradas
          </div>
        </div>
      </article>
    </section>

    <!-- Grid principal: tareas y alertas -->
    <section class="main-grid">
      <!-- Actividades Pendientes -->
      <article class="panel panel-tasks">
        <div class="panel-header">
          <h2 class="panel-title">Actividades Programadas</h2>
          <p class="panel-helper">
            Pr√≥ximas tareas y aplicaciones pendientes
          </p>
        </div>

        <ul class="task-list">
          @for (actividad of actividadesPendientes; track actividad.id) {
            <li class="task-item">
              <div class="task-main">
                <span class="task-chip" [ngClass]="'task-type-' + getTipoClass(actividad.tipo)">
                  {{ actividad.tipo }}
                </span>
                <span class="task-title">{{ actividad.nombre }}</span>
              </div>
              <div class="task-meta">
                <span class="task-time">{{ formatFecha(actividad.fechaProgramada) }}</span>
                <span class="task-status" [ngClass]="'status-' + actividad.estado.toLowerCase()">
                  {{ actividad.estado }}
                </span>
              </div>
              @if (actividad.responsable) {
                <span class="task-responsible">üë§ {{ actividad.responsable }}</span>
              }
            </li>
          }
        </ul>

        @if (actividadesPendientes.length === 0) {
          <div class="panel-empty">
            ‚úÖ No hay actividades pendientes
          </div>
        }
      </article>

      <!-- Alertas de Inventario -->
      <article class="panel panel-alerts">
        <div class="panel-header">
          <h2 class="panel-title">Alertas de Inventario</h2>
          <p class="panel-helper">
            Productos que requieren atenci√≥n
          </p>
        </div>

        <ul class="alert-list">
          @for (alerta of alertasInventario; track alerta.id) {
            <li class="alert-item">
              <div class="alert-main">
                <span class="alert-pill" [ngClass]="'severity-' + alerta.prioridad">
                  {{ alerta.prioridad | uppercase }}
                </span>
                <span class="alert-title">{{ alerta.itemNombre }}</span>
              </div>
              <p class="alert-description">{{ alerta.mensaje }}</p>
              <div class="alert-footer">
                <span class="alert-module">{{ alerta.tipo }}</span>
                <span class="alert-date">{{ formatFecha(alerta.fecha) }}</span>
              </div>
            </li>
          }
        </ul>

        @if (alertasInventario.length === 0) {
          <div class="panel-empty">
            ‚úÖ No hay alertas activas
          </div>
        }
      </article>
    </section>

    <!-- Grid secundario -->
    <section class="secondary-grid">
      <!-- Per√≠odos de Siembra Activos -->
      <article class="panel panel-periodos">
        <div class="panel-header">
          <h2 class="panel-title">Per√≠odos de Siembra Activos</h2>
          <p class="panel-helper">
            Cultivos en curso por parcela
          </p>
        </div>

        <ul class="periodo-list">
          @for (periodo of periodosActivos; track periodo.id) {
            <li class="periodo-item">
              <div class="periodo-header">
                <span class="periodo-codigo">{{ periodo.codigo }}</span>
                <span class="periodo-badge">{{ periodo.cultivo.nombre }}</span>
              </div>
              <div class="periodo-body">
                <p class="periodo-parcela">üìç {{ periodo.parcela.nombre }} - {{ periodo.hectareasSembradas }} ha</p>
                <div class="periodo-dates">
                  <span>Inicio: {{ formatFecha(periodo.fechaInicio) }}</span>
                  <span>Cosecha: {{ formatFecha(periodo.fechaCosechaEsperada) }}</span>
                </div>
                @if (periodo.rendimientoEsperado) {
                  <p class="periodo-rendimiento">
                    üéØ Rendimiento esperado: {{ periodo.rendimientoEsperado | number:'1.1-1' }} ton/ha
                  </p>
                }
              </div>
            </li>
          }
        </ul>

        @if (periodosActivos.length === 0) {
          <div class="panel-empty">
            No hay per√≠odos de siembra activos
          </div>
        }
      </article>

      <!-- Productos Bajo Stock -->
      <article class="panel panel-stock">
        <div class="panel-header">
          <h2 class="panel-title">Stock Bajo</h2>
          <p class="panel-helper">
            Productos cerca del m√≠nimo
          </p>
        </div>

        <ul class="stock-list">
          @for (item of productosBajoStock; track item.id) {
            <li class="stock-item">
              <div class="stock-main">
                <span class="stock-name">{{ item.nombre }}</span>
                <span class="stock-category">{{ item.categoria }}</span>
              </div>
              <div class="stock-levels">
                <div class="stock-bar">
                  <div 
                    class="stock-fill" 
                    [style.width.%]="getStockPercentage(item)"
                    [ngClass]="getStockClass(item)">
                  </div>
                </div>
                <span class="stock-text">
                  {{ item.stockActual | number:'1.0-0' }} / {{ item.stockMinimo | number:'1.0-0' }} {{ item.unidadMedida }}
                </span>
              </div>
            </li>
          }
        </ul>

        @if (productosBajoStock.length === 0) {
          <div class="panel-empty">
            ‚úÖ Todo el inventario est√° en niveles √≥ptimos
          </div>
        }
      </article>
    </section>
  }
</div>