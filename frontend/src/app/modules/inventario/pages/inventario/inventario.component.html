<!-- Inventario AgriCol - Diseño Minimalista -->

<div class="page-container">

  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-icon">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
        </svg>
      </div>
      <div>
        <h1 class="page-title">Inventario Agrícola</h1>
        <p class="page-subtitle">Gestión integral de insumos y materiales</p>
      </div>
    </div>

    <div class="header-actions">
      <button (click)="openNewMovementModal()" class="btn btn-primary">
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
        </svg>
        <span>Nuevo Movimiento</span>
      </button>

      <button (click)="openAlertsModal()" class="btn btn-secondary">
        <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
        </svg>
        <span>Alertas</span>
        <span [class.hidden]="alertas.length === 0" class="badge-alert">
          {{ alertas.length }}
        </span>
      </button>
    </div>
  </div>

  <!-- Estadísticas -->
  <div class="stats-grid">
    <!-- Total Items -->
    <div class="stat-card">
      <div class="stat-content">
        <p class="stat-label">Total Items</p>
        <p class="stat-value">{{ estadisticas.totalItems }}</p>
      </div>
      <div class="stat-icon stat-icon-blue">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
        </svg>
      </div>
    </div>

    <!-- Valor Total -->
    <div class="stat-card">
      <div class="stat-content">
        <p class="stat-label">Valor Total</p>
        <p class="stat-value">{{ estadisticas.valorTotal | currency:'MXN':'symbol':'1.0-0' }}</p>
        <p class="stat-hint">Total del inventario</p>
      </div>
      <div class="stat-icon stat-icon-green">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
    </div>

    <!-- Stock Bajo -->
    <div class="stat-card">
      <div class="stat-content">
        <p class="stat-label">Stock Bajo</p>
        <p class="stat-value stat-value-warning">{{ estadisticas.itemsBajoStock }}</p>
      </div>
      <div class="stat-icon stat-icon-orange">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
        </svg>
      </div>
    </div>

    <!-- Por Vencer -->
    <div class="stat-card">
      <div class="stat-content">
        <p class="stat-label">Por Vencer</p>
        <p class="stat-value stat-value-info">{{ estadisticas.itemsPorVencer }}</p>
      </div>
      <div class="stat-icon stat-icon-blue">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
    </div>

    <!-- Vencidos -->
    <div class="stat-card">
      <div class="stat-content">
        <p class="stat-label">Vencidos</p>
        <p class="stat-value stat-value-danger">{{ estadisticas.itemsVencidos }}</p>
      </div>
      <div class="stat-icon stat-icon-red">
        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <div class="filters-grid">
      <!-- Buscar -->
      <div class="filter-group filter-group-wide">
        <label class="filter-label">
          <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
          Buscar
        </label>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchChange()"
          placeholder="Buscar por nombre o código..."
          class="filter-input"
        />
      </div>

      <!-- Categoría -->
      <div class="filter-group">
        <label class="filter-label">
          <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
          </svg>
          Categoría
        </label>
        <div class="select-wrapper">
          <select [(ngModel)]="categoriaFiltro" (ngModelChange)="onCategoriaChange()" class="filter-select">
            <option value="TODAS">Todas las categorías</option>
            <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
          </select>
          <svg class="select-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </div>
      </div>

      <!-- Estado -->
      <div class="filter-group">
        <label class="filter-label">
          <svg class="label-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          Estado
        </label>
        <div class="select-wrapper">
          <select [(ngModel)]="estadoFiltro" (ngModelChange)="onEstadoChange()" class="filter-select">
            <option value="TODOS">Todos los estados</option>
            <option *ngFor="let est of estados" [value]="est">{{ est }}</option>
          </select>
          <svg class="select-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </div>
      </div>
    </div>

    <!-- Vista Toggle -->
    <div class="view-toggle">
      <span class="view-label">Vista:</span>
      <div class="toggle-buttons">
        <button
          (click)="cambiarVista('tabla')"
          [class.active]="vistaActual === 'tabla'"
          class="toggle-btn">
          <svg class="toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
          </svg>
          <span>Tabla</span>
        </button>
        <button
          (click)="cambiarVista('tarjetas')"
          [class.active]="vistaActual === 'tarjetas'"
          class="toggle-btn">
          <svg class="toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 6v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
          </svg>
          <span>Tarjetas</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Vista Tabla -->
  <div [class.hidden]="vistaActual !== 'tabla'" class="table-container">
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>Código</th>
            <th>Producto</th>
            <th>Categoría</th>
            <th>Stock</th>
            <th>Ubicación</th>
            <th>Valor</th>
            <th>Estado</th>
            <th>Vencimiento</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of itemsFiltrados">
            <td class="cell-code">{{ item.codigo }}</td>
            <td>
              <div class="product-cell">
                <p class="product-name">{{ item.nombre }}</p>
                <p class="product-brand">{{ item.marca }}</p>
              </div>
            </td>
            <td>{{ item.categoria }}</td>
            <td>
              <div class="stock-cell">
                <span class="stock-value"
                      [class.stock-ok]="item.stockActual > item.stockMinimo"
                      [class.stock-warning]="item.stockActual <= item.stockMinimo && item.stockActual > 0"
                      [class.stock-danger]="item.stockActual === 0">
                  {{ item.stockActual }} {{ item.unidadMedida }}
                </span>
                <span class="stock-min">Min: {{ item.stockMinimo }}</span>
              </div>
            </td>
            <td>
              <div class="location-cell">
                <span>{{ item.ubicacion }}</span>
                <span *ngIf="item.almacen" class="location-sub">{{ item.almacen }}</span>
              </div>
            </td>
            <td>
              <div class="value-cell">
                <span class="value-total">{{ item.valorTotal | currency:'MXN':'symbol':'1.0-0' }}</span>
                <span class="value-unit">{{ item.costoUnitario | currency:'MXN':'symbol':'1.2-2' }}/{{ item.unidadMedida }}</span>
              </div>
            </td>
            <td>
              <span [class]="getBadgeClass(item.estado)" class="badge">
                {{ item.estado }}
              </span>
            </td>
            <td>{{ item.fechaVencimiento | date:'dd/MM/yyyy' }}</td>
            <td>
              <div class="action-buttons">
                <button (click)="openEditItemModal(item)" class="action-btn action-btn-edit">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                  </svg>
                </button>
                <button (click)="openNewMovementModal(item)" class="action-btn action-btn-add">
                  <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="itemsFiltrados.length === 0" class="empty-state">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
      </svg>
      <h3 class="empty-title">No hay items</h3>
      <p class="empty-text">No se encontraron items con los filtros aplicados</p>
    </div>
  </div>

  <!-- Vista Tarjetas -->
  <div [class.hidden]="vistaActual !== 'tarjetas'" class="cards-grid">
    <div *ngFor="let item of itemsFiltrados" class="item-card">
      <div class="card-header">
        <div class="card-header-content">
          <h3 class="card-title">{{ item.nombre }}</h3>
          <p class="card-code">{{ item.codigo }}</p>
        </div>
        <span [class]="getBadgeClass(item.estado)" class="badge">
          {{ item.estado }}
        </span>
      </div>

      <div class="card-body">
        <div class="card-row">
          <span class="card-label">Stock Actual</span>
          <span class="card-value">{{ item.stockActual }} {{ item.unidadMedida }}</span>
        </div>
        <div class="card-row">
          <span class="card-label">Ubicación</span>
          <span class="card-value">{{ item.ubicacion }}</span>
        </div>
        <div class="card-row">
          <span class="card-label">Valor Total</span>
          <span class="card-value card-value-highlight">{{ item.valorTotal | currency:'MXN' }}</span>
        </div>
        <div class="card-row">
          <span class="card-label">Vencimiento</span>
          <span class="card-value">{{ item.fechaVencimiento | date:'dd/MM/yyyy' }}</span>
        </div>
      </div>

      <div class="card-footer">
        <button (click)="openEditItemModal(item)" class="card-btn card-btn-edit">
          <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
          <span>Editar</span>
        </button>
        <button (click)="openNewMovementModal(item)" class="card-btn card-btn-primary">
          <svg class="btn-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          <span>Movimiento</span>
        </button>
      </div>
    </div>

    <!-- Empty State Tarjetas -->
    <div *ngIf="itemsFiltrados.length === 0" class="empty-state empty-state-full">
      <svg class="empty-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"/>
      </svg>
      <h3 class="empty-title">No hay items</h3>
      <p class="empty-text">No se encontraron items con los filtros aplicados</p>
    </div>
  </div>

</div>

<!-- Modales -->
<app-new-movement *ngIf="showNewMovementModal" 
                  [item]="selectedItem" 
                  (closed)="closeNewMovementModal()">
</app-new-movement>

<app-edit-item *ngIf="showEditItemModal" 
               [item]="selectedItem"
               (closed)="closeEditItemModal()">
</app-edit-item>

<app-alerts *ngIf="showAlertsModal"
            [alertas]="alertas"
            (closed)="closeAlertsModal()">
</app-alerts>