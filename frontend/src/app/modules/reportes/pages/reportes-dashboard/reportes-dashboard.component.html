<div class="reportes-dashboard">
  <!-- Header -->
  <div class="page-header">
    <div class="header-content">
      <h1>üìä Reportes y An√°lisis</h1>
      <p>An√°lisis detallado de producci√≥n, costos y rendimiento</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-outline" (click)="exportarExcel()">
        üìÑ Exportar Excel
      </button>
      <button class="btn btn-primary" (click)="exportarPDF()">
        üì• Exportar PDF
      </button>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <div class="filters-row">
      <div class="filter-group">
        <label>Fecha Inicio</label>
        <input type="date" [(ngModel)]="fechaInicio" class="form-control">
      </div>
      <div class="filter-group">
        <label>Fecha Fin</label>
        <input type="date" [(ngModel)]="fechaFin" class="form-control">
      </div>
      <div class="filter-actions">
        <button class="btn btn-secondary" (click)="limpiarFiltros()">
          Limpiar
        </button>
        <button class="btn btn-primary" (click)="aplicarFiltros()">
          üîç Buscar
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando datos...</p>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && dashboardData" class="dashboard-content">
    
    <!-- Resumen General -->
    <div class="stats-grid">
      <div class="stat-card blue">
        <div class="stat-icon">üåæ</div>
        <div class="stat-content">
          <h3>{{ dashboardData.resumenGeneral.totalParcelas }}</h3>
          <p>Parcelas Activas</p>
        </div>
      </div>

      <div class="stat-card green">
        <div class="stat-icon">üìè</div>
        <div class="stat-content">
          <h3>{{ dashboardData.resumenGeneral.hectareasTotales.toFixed(1) }}</h3>
          <p>Hect√°reas Totales</p>
        </div>
      </div>

      <div class="stat-card orange">
        <div class="stat-icon">üå±</div>
        <div class="stat-content">
          <h3>{{ dashboardData.resumenGeneral.cultivosActivos }}</h3>
          <p>Cultivos Activos</p>
        </div>
      </div>

      <div class="stat-card purple">
        <div class="stat-icon">üí∞</div>
        <div class="stat-content">
          <h3>${{ dashboardData.resumenGeneral.costoTotalAcumulado.toLocaleString('es-MX') }}</h3>
          <p>Costo Total Acumulado</p>
        </div>
      </div>
    </div>

    <!-- Gr√°ficas -->
    <div class="charts-grid">
      <!-- Gr√°fica de Consumo -->
      <div class="chart-card">
        <apx-chart
          [series]="chartConsumoOptions.series!"
          [chart]="chartConsumoOptions.chart!"
          [xaxis]="chartConsumoOptions.xaxis!"
          [yaxis]="chartConsumoOptions.yaxis!"
          [dataLabels]="chartConsumoOptions.dataLabels!"
          [title]="chartConsumoOptions.title!"
          [colors]="chartConsumoOptions.colors!"
          [plotOptions]="chartConsumoOptions.plotOptions!"
          [tooltip]="chartConsumoOptions.tooltip!"
        ></apx-chart>
      </div>

      <!-- Gr√°fica de Costos -->
      <div class="chart-card">
        <apx-chart
          [series]="chartCostosOptions.series!"
          [chart]="chartCostosOptions.chart!"
          [xaxis]="chartCostosOptions.xaxis!"
          [yaxis]="chartCostosOptions.yaxis!"
          [stroke]="chartCostosOptions.stroke!"
          [dataLabels]="chartCostosOptions.dataLabels!"
          [title]="chartCostosOptions.title!"
          [colors]="chartCostosOptions.colors!"
          [fill]="chartCostosOptions.fill!"
          [tooltip]="chartCostosOptions.tooltip!"
        ></apx-chart>
      </div>
    </div>

    <!-- Per√≠odos de Siembra Activos -->
    <div class="section-card">
      <div class="section-header">
        <h2>üå± Per√≠odos de Siembra Activos</h2>
        <button class="btn btn-primary" routerLink="/periodos-siembra/nuevo">
          + Nuevo Per√≠odo
        </button>
      </div>

      <div *ngIf="dashboardData.periodosActivos.length === 0" class="empty-state">
        <p>No hay per√≠odos de siembra activos</p>
        <button class="btn btn-primary" routerLink="/periodos-siembra/nuevo">
          Crear Primer Per√≠odo
        </button>
      </div>

      <div *ngIf="dashboardData.periodosActivos.length > 0" class="periodos-grid">
        <div *ngFor="let periodo of dashboardData.periodosActivos" class="periodo-card">
          <div class="periodo-header">
            <h3>{{ periodo.cultivo }}</h3>
            <span class="badge badge-success">{{ periodo.estado }}</span>
          </div>
          <div class="periodo-info">
            <div class="info-row">
              <span class="label">Parcela:</span>
              <span class="value">{{ periodo.parcela }}</span>
            </div>
            <div class="info-row">
              <span class="label">Hect√°reas:</span>
              <span class="value">{{ periodo.hectareas }} ha</span>
            </div>
            <div class="info-row">
              <span class="label">Fecha Siembra:</span>
              <span class="value">{{ periodo.fechaInicio | date: 'dd/MM/yyyy' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Cosecha Esperada:</span>
              <span class="value">{{ periodo.fechaCosechaEsperada | date: 'dd/MM/yyyy' }}</span>
            </div>
          </div>
          <div class="periodo-progress">
            <div class="progress-label">
              <span>Progreso</span>
              <span>{{ periodo.progreso }}%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="periodo.progreso"></div>
            </div>
          </div>
          <button class="btn btn-sm btn-outline" [routerLink]="['/periodos-siembra', periodo.id]">
            Ver Detalle
          </button>
        </div>
      </div>
    </div>

    <!-- Alertas Recientes -->
    <div class="section-card" *ngIf="dashboardData.alertas.length > 0">
      <div class="section-header">
        <h2>‚ö†Ô∏è Alertas Recientes</h2>
      </div>

      <div class="alertas-list">
        <div *ngFor="let alerta of dashboardData.alertas" 
             class="alerta-item"
             [class.alerta-critica]="alerta.prioridad === 'alta'"
             [class.alerta-media]="alerta.prioridad === 'media'">
          <div class="alerta-icon">
            <span *ngIf="alerta.tipo === 'stock'">üì¶</span>
            <span *ngIf="alerta.tipo === 'vencimiento'">‚è∞</span>
            <span *ngIf="alerta.tipo === 'aplicacion'">üéØ</span>
          </div>
          <div class="alerta-content">
            <h4>{{ alerta.titulo }}</h4>
            <p>{{ alerta.mensaje }}</p>
            <span class="alerta-fecha">{{ alerta.fecha | date: 'dd/MM/yyyy HH:mm' }}</span>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>