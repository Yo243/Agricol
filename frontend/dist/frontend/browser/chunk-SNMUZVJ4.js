import{a as g}from"./chunk-2F5RLYLV.js";import{d as l}from"./chunk-YAFIELCV.js";import{H as i,L as u,Q as n,ec as c,g as o,k as s,v as a}from"./chunk-PCLR6J3H.js";var m=class r{http=n(c);router=n(l);apiUrl=`${g.apiUrl}/auth`;currentUserSubject=new o(null);currentUser$=this.currentUserSubject.asObservable();constructor(){let e=this.getUserFromStorage();e&&this.currentUserSubject.next(e)}login(e){return this.http.post(`${this.apiUrl}/login`,e).pipe(i(t=>{this.saveAuthData(t)}),a(t=>s(()=>this.handleLoginError(t))))}handleLoginError(e){console.error("Error en login:",e);let t="Error al iniciar sesi\xF3n. Intenta nuevamente.",p=e.status;return e.status===403?t=e.error?.error||e.error?.message||"Tu cuenta ha sido desactivada. Contacta al administrador para m\xE1s informaci\xF3n.":e.status===401?t="Email o contrase\xF1a incorrectos. Verifica tus datos.":e.status===500?t="Error en el servidor. Intenta m\xE1s tarde.":e.status===0&&(t="No se pudo conectar con el servidor. Verifica tu conexi\xF3n."),{message:t,statusCode:p}}saveAuthData(e){localStorage.setItem("token",e.token),localStorage.setItem("user",JSON.stringify(e.user)),this.currentUserSubject.next(e.user)}logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.currentUserSubject.next(null),this.router.navigate(["/login"])}getToken(){return localStorage.getItem("token")}getCurrentUser(){return this.currentUserSubject.value}getUserFromStorage(){let e=localStorage.getItem("user");if(e)try{return JSON.parse(e)}catch{return null}return null}isAuthenticated(){return!!this.getToken()}isAdmin(){return this.getCurrentUser()?.role==="admin"}static \u0275fac=function(t){return new(t||r)};static \u0275prov=u({token:r,factory:r.\u0275fac,providedIn:"root"})};export{m as a};
