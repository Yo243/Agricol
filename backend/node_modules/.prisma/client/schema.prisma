generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  name      String
  role      String   @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("users")
}

model InventarioItem {
  id               Int       @id @default(autoincrement())
  codigo           String?   @unique
  nombre           String
  descripcion      String?
  categoria        String
  unidadMedida     String
  stockActual      Float     @default(0)
  stockMinimo      Float     @default(0)
  stockMaximo      Float?
  costoUnitario    Float     @default(0)
  valorTotal       Float     @default(0)
  estado           String    @default("Disponible")
  ubicacion        String?
  lote             String?
  proveedor        String?
  fechaAdquisicion DateTime?
  fechaVencimiento DateTime?
  diasParaVencer   Int?
  observaciones    String?
  activo           Boolean   @default(true)
  ultimoMovimiento DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  movimientos MovimientoInventario[]
  alertas     AlertaInventario[]

  @@map("inventario_items")
}

model MovimientoInventario {
  id            Int      @id @default(autoincrement())
  itemId        Int
  tipo          String
  cantidad      Float
  unidadMedida  String?
  costoUnitario Float?
  costoTotal    Float?
  fecha         DateTime @default(now())
  razon         String?
  referencia    String?
  destino       String?
  responsable   String?
  createdAt     DateTime @default(now())

  item InventarioItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@map("movimientos_inventario")
}

model AlertaInventario {
  id          Int      @id @default(autoincrement())
  itemId      Int
  itemNombre  String?
  tipo        String
  tipoAlerta  String?
  mensaje     String
  prioridad   String   @default("media")
  leida       Boolean  @default(false)
  fecha       DateTime @default(now())
  fechaAlerta DateTime @default(now())
  createdAt   DateTime @default(now())

  item InventarioItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@map("alertas_inventario")
}
